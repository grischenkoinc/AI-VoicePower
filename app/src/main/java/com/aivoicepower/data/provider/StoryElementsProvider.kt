package com.aivoicepower.data.provider

import com.aivoicepower.domain.model.exercise.StoryFormat
import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class StoryElementsProvider @Inject constructor() {

    // Герої для історій
    private val heroes = listOf(
        "старий мудрець", "юна винахідниця", "самотній мандрівник",
        "відважний лицар", "хитрий шахрай", "добра відьма",
        "загублений студент", "таємничий незнайомець", "веселий музикант",
        "сором'язливий поет", "амбітний підприємець", "чарівний кіт"
    )

    // Місця дій
    private val places = listOf(
        "покинутий замок", "таємнича бібліотека", "шумний ринок",
        "тихий ліс", "сучасне кафе", "космічна станція",
        "підземне місто", "гірський притулок", "плавуча острів",
        "старовинний театр", "футуристична лабораторія", "зачарований сад"
    )

    // Предмети для історії
    private val items = listOf(
        "заржавілий ключ", "світна книга", "старовинна карта",
        "дивна скринька", "магічний амулет", "поламаний годинник",
        "таємничий лист", "золота монета", "срібне дзеркало",
        "кришталева куля", "стара фотографія", "незвичайний камінь"
    )

    // Твісти/повороти подій
    private val twists = listOf(
        "раптом зникає світло", "з'являється портал у інший вимір",
        "головний герой виявляється не тим, за кого себе видавав",
        "виявляється, що це було пророцтво", "час починає йти у зворотному напрямку",
        "з'являється несподіваний союзник", "зрада найближчого друга",
        "важливий предмет виявляється підробкою", "герой отримує неочікувану силу",
        "виявляється секретний родинний зв'язок", "місія була пасткою з самого початку",
        "герой знаходить давно втрачений спогад"
    )

    // Початки історій для режиму "Продовж історію"
    private val storyBeginnings = listOf(
        "Того дня, коли все змінилося, небо мало незвичний відтінок...",
        "Лист прийшов без зворотної адреси, і це було лише початком загадки...",
        "Старий годинник зупинився рівно о півночі, і тоді я почув голос...",
        "Вона знайшла карту в бабусиній скрині, і вирішила перевірити, чи існує це місце...",
        "Кіт подивився на мене і промовив людським голосом...",
        "Коли я прокинувся, то зрозумів, що забув останні три дні свого життя...",
        "Двері, яких тут ніколи не було, з'явилися посеред стіни...",
        "Останній автобус зупинився, хоча я не натискав кнопку зупинки...",
        "Фотографія показала щось, чого я точно не бачив, коли знімав...",
        "Дощ припинився саме тоді, коли я торкнувся дерева...",
        "У дзеркалі відображення посміхнулося, хоча я цього не робив...",
        "Книга відкрилася сама, і текст почав світитися..."
    )

    // Випадкові слова для вплетення в історію
    private val randomWordSets = listOf(
        listOf("парасолька", "мрія", "дракон"),
        listOf("скрипка", "таємниця", "місяць"),
        listOf("ключ", "подорож", "зірка"),
        listOf("книга", "вітер", "свобода"),
        listOf("дзеркало", "пісня", "надія"),
        listOf("двері", "спогад", "океан"),
        listOf("світло", "танець", "крила"),
        listOf("годинник", "слово", "магія"),
        listOf("вікно", "серце", "гора"),
        listOf("лист", "мелодія", "шлях"),
        listOf("камінь", "голос", "ніч"),
        listOf("сад", "казка", "сонце")
    )

    fun getRandomHero(): String = heroes.random()
    fun getRandomPlace(): String = places.random()
    fun getRandomItem(): String = items.random()
    fun getRandomTwist(): String = twists.random()
    fun getRandomStoryBeginning(): String = storyBeginnings.random()
    fun getRandomWordSet(): List<String> = randomWordSets.random()

    fun getStoryPrompt(format: StoryFormat): String {
        return when (format) {
            StoryFormat.WITH_PROMPTS -> {
                val hero = getRandomHero()
                val place = getRandomPlace()
                val item = getRandomItem()
                val twist = getRandomTwist()
                "Створи історію про: $hero у локації $place, який знаходить $item. Твіст: $twist"
            }
            StoryFormat.FROM_IMAGE -> {
                // TODO Phase 8: Генерація зображення через AI
                "Опиши та розкажи історію за цією картинкою (генерація зображення буде в Phase 8)"
            }
            StoryFormat.CONTINUE -> {
                val beginning = getRandomStoryBeginning()
                "Продовж цю історію: \"$beginning\""
            }
            StoryFormat.RANDOM_WORDS -> {
                val words = getRandomWordSet()
                "Створи історію, використовуючи ці три слова: ${words.joinToString(", ")}"
            }
        }
    }
}
